<script>
  function showInputs() {
    document.getElementById('inputFields').classList.remove('hidden');
  }

  document.getElementById('reportForm').addEventListener('submit', function (e) {
    e.preventDefault(); // Chặn gửi mặc định
    const form = this;
    const formData = new FormData(form);

    // Hiện modal loading
    const modal = document.getElementById('thankModal');
    const modalContent = document.getElementById('modalContent');
    const statusText = document.getElementById('statusText');
    const spinner = document.getElementById('loadingSpinner');

    modal.style.display = 'flex';
    statusText.innerText = 'Đang gửi báo cáo, vui lòng chờ...';
    spinner.style.display = 'block';

    fetch(form.action, {
      method: 'POST',
      body: formData
    })
    .then(res => res.text())
    .then(html => {
      spinner.style.display = 'none';
      modalContent.innerHTML = html;

      setTimeout(() => {
        modal.style.display = 'none';
        form.reset();
        document.getElementById('inputFields').classList.add('hidden');
        document.querySelectorAll('input[name="loai"]').forEach(r => r.checked = false);
      }, 7000);
    })
    .catch(err => {
      spinner.style.display = 'none';
      statusText.innerHTML = '❌ Gửi thất bại. Vui lòng thử lại sau!';
      console.error(err);
      setTimeout(() => modal.style.display = 'none', 4000);
    });
  });
</script>
